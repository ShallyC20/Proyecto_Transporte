<!-- components/detalle.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Detalle del Vehículo</title>
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="../css/detalle.css" />
  <link rel="stylesheet" href="../css/mainHeader.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <div id="mainHeaderContainer"></div>

  <main id="mainDetalleContainer" style="display: none">
    <section class="pagina-transporte">
      <header class="header">
        <h2>Sistema de Alquiler - <strong>Detalle del vehículo</strong></h2>
      </header>

      <div class="detalle-container">
        <div class="detalle-imagen">
          <img id="detalleImagen" src="" alt="Imagen del vehículo">
        </div>
        <div class="detalle-info">
          <h1 id="detalleNombre"></h1>
          <div id="detalleBadge" class="badge"></div>
          <p><strong>Tarifa:</strong> Bs. <span id="detalleTarifa"></span>/hora</p>
          <p><strong>Estación:</strong> <span id="detalleEstacion"></span></p>
          <p><strong>Descripción:</strong></p>
          <p id="detalleDescripcion"></p>
          <p><strong>Tecnología:</strong></p>
          <ul id="detalleTecnologia"></ul>
          
          <div class="botones-detalle">
            <button class="volver-btn" onclick="window.history.back()">
              <i class="fas fa-arrow-left"></i> Volver
            </button>
            <button class="alquilar-btn" id="btnAlquilar">
              <i class="fas fa-key"></i> Alquilar
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('/components/Rental_Payments/Templates/Header.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById("mainHeaderContainer").innerHTML = html;

          const script1 = document.createElement('script');
          script1.src = '../js/menu.js';
          script1.onload = () => {
            const script2 = document.createElement('script');
            script2.src = '../js/headerEvents.js';
            script2.onload = () => {
              if (typeof initHeaderEvents === 'function') initHeaderEvents();
            };
            document.body.appendChild(script2);
          };
          document.body.appendChild(script1);
        });

      const data = JSON.parse(localStorage.getItem('productoSeleccionado'));
      if (!data) {
        document.body.innerHTML += '<h2 style="text-align:center;margin-top:4rem;">Producto no encontrado</h2>';
        return;
      }

      window.requestAnimationFrame(() => {
        document.getElementById('mainDetalleContainer').style.display = 'block';
        document.getElementById('detalleImagen').src = data.imagen;
        document.getElementById('detalleImagen').alt = data.alt;
        document.getElementById('detalleNombre').textContent = data.nombre;
        document.getElementById('detalleTarifa').textContent = data.tarifa?.toFixed(2) || '0.00';
        document.getElementById('detalleEstacion').textContent = data.estacion || '-';
        document.getElementById('detalleDescripcion').textContent = data.descripcion || 'No disponible.';

        const badge = document.getElementById('detalleBadge');
        badge.textContent = data.estado || 'Desconocido';

        switch ((data.estado || '').trim()) {
          case "Disponible":
            badge.classList.add('badge-disponible'); break;
          case "En uso":
            badge.classList.add('badge-en-uso'); break;
          case "En mantenimiento":
            badge.classList.add('badge-mante'); break;
          default:
            badge.classList.add('badge-default'); break;
        }

        const ul = document.getElementById('detalleTecnologia');
        if (Array.isArray(data.tecnologia) && data.tecnologia.length > 0) {
          data.tecnologia.forEach(tec => {
            const li = document.createElement('li');
            li.textContent = tec;
            ul.appendChild(li);
          });
        } else {
          const li = document.createElement('li');
          li.textContent = 'Sin tecnología registrada.';
          li.style.fontStyle = 'italic';
          ul.appendChild(li);
        }

        const btnAlquilar = document.getElementById("btnAlquilar");
        btnAlquilar.addEventListener("click", () => {
          const estado = (data.estado || '').trim();
          switch (estado) {
            case "Disponible":
              localStorage.setItem("vehiculoEnAlquiler", JSON.stringify(data));
              window.location.href = "/components/Rental_Payments/Renta/PageRental.html";
              break;
            case "En uso":
              Swal.fire({
                icon: 'warning',
                title: 'Vehículo en uso',
                text: 'Este vehículo ya está siendo utilizado. Intenta con otro.',
                confirmButtonColor: '#f1c40f'
              });
              break;
            case "Mantenimiento":
              Swal.fire({
                icon: 'error',
                title: 'Vehículo en mantenimiento',
                text: 'Este vehículo está fuera de servicio temporalmente.',
                confirmButtonColor: '#e74c3c'
              });
              break;
            default:
              Swal.fire({
                icon: 'question',
                title: 'Estado desconocido',
                text: 'No se puede determinar el estado del vehículo.',
                confirmButtonColor: '#7f8c8d'
              });
              break;
          }
        });
      });
    });
  </script>

  <div id="mainFooterContainer"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('../components/footer.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById("mainFooterContainer").innerHTML = html;
        })
        .catch(err => console.error("Error al cargar el footer:", err));
    });
  </script>
  <script src="/components/Rental_Payments/loader/insertloader.js"></script>
  <script>
    window.loaderDuration = 500; // 5 segundos
  </script>
  <script src="/components/Rental_Payments/loader/loader.js"></script>
</body>
</html>
