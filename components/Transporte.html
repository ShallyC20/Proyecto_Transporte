<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transporte</title>

  <!-- Estilos -->
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

  <div id="mainHeaderContainers"></div>

  <section class="pagina-transporte">
    <header class="header">
      <h2>Sistema de Alquiler - <strong>Visualizaci√≥n de transporte</strong></h2>
      <div class="filters">
        <select id="filterTipo">
          <option value="Todo">Todos</option>
          <option value="Bicicleta">Bicicletas</option>
          <option value="Patineta">Patinetas</option>
        </select>

        <select id="filterEstado">
          <option value="Todo">Todo</option>
          <option value="Disponible">Disponible</option>
          <option value="En uso">En uso</option>
          <option value="Mantenimiento">Mantenimiento</option>
        </select>

        <select id="filterTarifa">
          <option value="Default">Tarifa</option>
          <option value="asc">Menor a mayor</option>
          <option value="desc">Mayor a menor</option>
        </select>
      </div>
    </header>

    <div class="product-grid" id="gridTransportes"></div>
  </section>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/11.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore-compat.js"></script>
  <script src="../js/conexionFirebase.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const grid = document.getElementById('gridTransportes');
      const tipo = document.getElementById('filterTipo');
      const estado = document.getElementById('filterEstado');
      const tarifa = document.getElementById('filterTarifa');
      let productos = [];

      function renderProductos(data) {
        grid.innerHTML = '';

        if (data.length === 0) {
          grid.innerHTML = '<p>No hay transportes que coincidan con los filtros.</p>';
          return;
        }

        data.forEach(producto => {
          const card = document.createElement('div');
          card.classList.add('card');

          const badgeClass = {
            "Disponible": "badge-disponible",
            "En uso": "badge-en-uso",
            "Mantenimiento": "badge-mantenimiento"
          }[producto.estado] || "badge-default";

          card.innerHTML = `
            <div class="badge ${badgeClass}">${producto.estado}</div>
            <img src="${producto.imagen || 'https://via.placeholder.com/150'}" alt="${producto.alt || producto.nombre}">
            <div class="card-info">
              <h4>${producto.nombre}</h4>
              <p>Estaci√≥n: ${producto.estacion}</p>
              <p><strong>Bs${producto.tarifa?.toFixed(2) || '0.00'}/hora</strong></p>
            </div>
          `;

          card.addEventListener("click", () => {
            localStorage.setItem("productoSeleccionado", JSON.stringify(producto));
            window.location.href = "../components/detalle.html";
          });

          grid.appendChild(card);
        });
      }

      function aplicarFiltros() {
        let filtrados = [...productos];

        if (tipo.value !== "Todo") {
          filtrados = filtrados.filter(p => p.tipo === tipo.value);
        }

        if (estado.value !== "Todo") {
          filtrados = filtrados.filter(p => p.estado === estado.value);
        }

        if (tarifa.value === "asc") {
          filtrados.sort((a, b) => a.tarifa - b.tarifa);
        } else if (tarifa.value === "desc") {
          filtrados.sort((a, b) => b.tarifa - a.tarifa);
        }

        renderProductos(filtrados);
      }

      db.collection("transporte").get().then(snapshot => {
        productos = snapshot.docs.map(doc => {
          const data = doc.data();
          data.docId = doc.id; // üîë Agregamos el ID del documento
          return data;
        });

        renderProductos(productos);
      }).catch(err => {
        console.error('Error al obtener datos de Firebase:', err);
        grid.innerHTML = '<p style="color:red;">No se pudieron cargar los transportes.</p>';
      });

      [tipo, estado, tarifa].forEach(select => {
        select.addEventListener('change', aplicarFiltros);
      });
    });
  </script>

  <script src="../js/script.js" defer></script>

  <div id="mainFooterContainer"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('../components/footer.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById("mainFooterContainer").innerHTML = html;
        })
        .catch(err => console.error("Error al cargar el footer:", err));
    });
  </script>
    <script>
    document.addEventListener("DOMContentLoaded", async () => {
      fetch("/components/Rental_Payments/Templates/Header.html")
        .then(res => res.text())
        .then(html => {
          document.getElementById("mainHeaderContainers").innerHTML = html;
          setTimeout(() => {
            const usuario = JSON.parse(localStorage.getItem("usuario"));
            if (usuario) {
              document.getElementById("userName").textContent = usuario.nombre || "Usuario";
              document.getElementById("userAvatar").src = usuario.imagen || "";
            }
          }, 100);
        })
        .catch(err => console.error("Error al cargar el header:", err));
    });
  </script>
</body>
</html>
