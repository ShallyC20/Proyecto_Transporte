<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/mapas.css" />
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="mainHeaderContainers"></div>
    <section class="mapprincipal">
        <div class="titulo">
            <h2>Ubicaciones - <strong>Visualización de puntos de Control</strong></h2>
        </div>
        <div class="tarjetaMapaPrin">
            <div class="contmapa">
                <div id="map" class="mapa"></div>
            </div>
            <div id="coordenadas" class="coordenadas"></div>
        </div>
    </section>
    <section class="infoubicaciones">
        <div id="contetarjetasubi" class="contetarjetasubi">
        </div>
    </section>
    <!-- Footer -->
    <div id="mainFooterContainer"></div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', () => {

        fetch('/components/footer.html')
            .then(res => res.text())
            .then(html => {
                document.getElementById("mainFooterContainer").innerHTML = html;
            });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", async () => {
        // Cargar Header
        fetch("/components/Rental_Payments/Templates/Header.html")
            .then(res => res.text())
            .then(html => {
                const container = document.getElementById("mainHeaderContainers");

                // Crear un contenedor temporal
                const temp = document.createElement("div");
                temp.innerHTML = html;

                // Ejecutar scripts embebidos manualmente
                const scripts = temp.querySelectorAll("script");
                scripts.forEach(script => {
                    const newScript = document.createElement("script");
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });

                // Limpiar los scripts del HTML antes de insertar
                temp.querySelectorAll("script").forEach(s => s.remove());

                // Agregar el HTML restante al contenedor
                container.innerHTML = temp.innerHTML;

                // Esperar a que el DOM del header esté listo
                setTimeout(() => {
                    const usuarioRaw = localStorage.getItem("usuario");
                    if (!usuarioRaw) return;

                    try {
                        const usuario = JSON.parse(usuarioRaw);
                        const nombre = usuario.nombre || "Usuario";
                        const imagen = usuario.imagen || "/imag/monito.png";

                        const userNameLabel = document.getElementById("userName");
                        if (userNameLabel) userNameLabel.textContent = nombre;

                        const userAvatar = document.getElementById("userAvatar");
                        if (userAvatar) userAvatar.src = imagen;

                        const avatarMenu = document.getElementById("avatarMenu");
                        const nombreMenu = document.getElementById("nombreMenu");
                        if (avatarMenu) avatarMenu.src = imagen;
                        if (nombreMenu) nombreMenu.textContent = nombre;

                    } catch (error) {
                        console.error("Error al parsear usuario desde localStorage:", error);
                    }
                }, 100);
            })
            .catch(err => console.error("Error al cargar el header:", err));
    });
</script>
  <script src="/components/Rental_Payments/loader/insertloader.js"></script>
  <script>
    window.loaderDuration = 2000; // 5 segundos
  </script>
  <script src="/components/Rental_Payments/loader/loader.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script type="module" src="/js/mapas.js"></script>

</html>