<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BISITRACK - Renta</title>
  <link rel="stylesheet" href="/css/contacIndex.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="/components/Rental_Payments/pageini/inicio.css" />
  <link rel="stylesheet" href="/components/Rental_Payments/loader/loader.css"
    onload="document.body.style.visibility='visible'">
  <style>
    body {
      visibility: hidden;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <div id="mainHeaderContainer"></div>

  <!-- Página principal -->
  <div class="PaginaInicio">

    <!-- INICIO -->
    <section id="inicio" class="pageini-hero">
      <div class="pageini-overlay">
        <div class="pageini-container">
          <h1 class="pageini-title"><span class="pageini-yellow">BICITRACK</span></h1>
          <p class="pageini-subtext">Con BISITRACK puedes monitorear, optimizar y gestionar tu red de vehículos en
            tiempo real.</p>
          <div class="pageini-buttons">
            <a href="/components/Rental_Payments/Login and register/LoginRegister.html?mode=login"
              class="pageini-btn-outline">Iniciar sesión</a>
            <a href="/components/Rental_Payments/Login and register/LoginRegister.html?mode=register"
              class="pageini-btn-filled">Registrarse</a>
          </div>
        </div>
      </div>
    </section>

    <!-- SERVICIO -->
    <section id="servicio" class="pageini-carousel-section">
      <h2 class="pageini-carousel-title">Servicio de Transporte</h2>
      <div class="pageini-info-transporte">
        <p>
          ¡Explora la ciudad de forma ecológica! BISITRACK te ofrece estaciones inteligentes de bicicletas y monopatines
          eléctricos en puntos clave de La Paz:
          <strong>EMI - Obrajes</strong>, <strong>Irpavi</strong>, <strong>Obrajes</strong> y <strong>Alto
            Irpavi</strong>.
        </p>
      </div>

      <div class="pageini-carousel-container">
        <button class="pageini-carousel-btn left" onclick="scrollCarousel(-1)">&#10094;</button>
        <div class="pageini-carousel" id="pageini-carousel">
          <div class="pageini-card"><img src="/components/Rental_Payments/pageini/emi.png" alt="Unidad 1">
            <h3>Escuela Militar de Ingeniería</h3>
            <p>Punto principal de alquiler en Obrajes, con acceso rápido a toda la zona sur.</p>
          </div>
          <div class="pageini-card"><img src="/components/Rental_Payments/pageini/Irpavi.png" alt="Ruta 2">
            <h3>Irpavi</h3>
            <p>Ideal para desplazarte entre residenciales y avenidas principales de la zona este.</p>
          </div>
          <div class="pageini-card"><img src="/components/Rental_Payments/pageini/Obrajes.png" alt="Horarios">
            <h3>Obrajes</h3>
            <p>Zona intermedia con alta conectividad hacia el centro y la parte sur de la ciudad.</p>
          </div>
          <div class="pageini-card"><img src="/components/Rental_Payments/pageini/Altoirpavi.png" alt="Reportes">
            <h3>Alto Irpavi</h3>
            <p>Zona residencial con caminos ideales para recorrer en monopatín o bicicleta eléctrica.</p>
          </div>
        </div>
        <button class="pageini-carousel-btn right" onclick="scrollCarousel(1)">&#10095;</button>
      </div>

      <div id="mapa-transporte" style="height: 400px; margin-top: 50px; border-radius: 12px;"></div>
    </section>

    <!-- NOSOTROS -->
    <section id="nosotros" class="pageini-nosotros">
      <h2 class="pageini-nosotros-title">Sobre Nosotros</h2>
      <div class="pageini-nosotros-cards">
        <div class="pageini-card">
          <img src="/components/Rental_Payments/pageini/imagen 1.jpg" alt="Artículo 1">
          <h3>Somos BISITRACK</h3>
          <p>Nacimos con el objetivo de transformar la movilidad urbana en La Paz.</p>
        </div>
        <div class="pageini-card">
          <img src="/components/Rental_Payments/pageini/imagen 2.jpg" alt="Artículo 2">
          <h3>Misión</h3>
          <p>Ofrecer soluciones de transporte sostenible que conecten zonas clave.</p>
        </div>
        <div class="pageini-card">
          <img src="/components/Rental_Payments/pageini/imange 3.webp" alt="Artículo 3">
          <h3>Compromiso</h3>
          <p>Por un futuro más verde y movilidad inteligente desde tu celular.</p>
        </div>
      </div>
    </section>

    <!-- CONTACTOS / COMENTARIOS -->
    <section id="contactos" class="pageini-contacto">
      <div class="pageini-contacto-container">
        <div class="pageini-contacto-form">
          <h2>Comentarios</h2>
          <form id="formXSS">
            <input type="text" id="nombreXSS" placeholder="Full Name" required />
            <textarea id="mensajeXSS" placeholder="Message" rows="5" required></textarea>
            <button type="submit">Send</button>
          </form>
        </div>
        <div class="pageini-contacto-links">
          <div>
            <h3>Company</h3>
            <ul>
              <li><a href="#">Inicio</a></li>
              <li><a href="#">Servicio</a></li>
              <li><a href="#">Nosotros</a></li>
              <li><a href="#">Contactos</a></li>
            </ul>
          </div>
          <div>
            <h3>Services</h3>
            <ul>
              <li><a href="#">Web Design</a></li>
              <li><a href="#">Graphics Design</a></li>
              <li><a href="#">App Design</a></li>
              <li><a href="#">SEO</a></li>
              <li><a href="#">Marketing</a></li>
              <li><a href="#">Analytic</a></li>
            </ul>
          </div>
          <div>
            <h3>Último comentario</h3>
            <div id="comentariosXSS" style="
              margin-top: 10px;
              padding: 10px;
              border: 1px solid #ccc;
              max-height: 200px;
              overflow-y: auto;
              font-size: 14px;
              background-color: #f8f8f8;
              border-radius: 8px;
            "></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- FOOTER -->
  <div id="mainFooterContainer"></div>

  <!-- Firebase & lógica -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="/js/conexionFireBase.js"></script>

  <script>
    const db = firebase.firestore();
    const form = document.getElementById("formXSS");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nombre = document.getElementById("nombreXSS").value;
      const mensaje = document.getElementById("mensajeXSS").value;
      await db.collection("comentariosXSS").add({ nombre, mensaje });
      form.reset();
      mostrarComentarios(); // recarga después de enviar
    });

    function mostrarComentarios() {
      const contenedor = document.getElementById("comentariosXSS");
      contenedor.innerHTML = "";

      db.collection("comentariosXSS")
        .orderBy("mensaje", "desc") // puedes cambiar por timestamp si deseas
        .get()
        .then(snapshot => {
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            // ⚠️ VULNERABILIDAD XSS: se inyecta sin filtrar
            div.innerHTML = `<strong>${data.nombre}:</strong> ${data.mensaje}`;
            div.style.marginBottom = "8px";
            contenedor.appendChild(div);
          });
        });
    }

    mostrarComentarios();
  </script>

  <!-- Header / Footer dinámicos -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      fetch('/components/Rental_Payments/pageini/headerini.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById("mainHeaderContainer").innerHTML = html;
        });

      fetch('/components/footer.html')
        .then(res => res.text())
        .then(html => {
          document.getElementById("mainFooterContainer").innerHTML = html;
        });
    });

    function scrollCarousel(direction) {
      const container = document.getElementById('pageini-carousel');
      const card = container.querySelector('.pageini-card');
      const scrollAmount = card.offsetWidth + 30;
      container.scrollTo({
        left: container.scrollLeft + direction * scrollAmount,
        behavior: 'smooth'
      });
    }
  </script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Asegurar que el mapa se muestra correctamente
    document.body.style.visibility = 'visible';

    // Inicializar el mapa solo si existe el contenedor
    const contenedorMapa = document.getElementById('mapa-transporte');
    if (contenedorMapa) {
      const map = L.map('mapa-transporte').setView([-16.525, -68.11], 14);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      const ubicaciones = [
        { nombre: "EMI - Obrajes", lat: -16.52686, lng: -68.10520 },
        { nombre: "Irpavi", lat: -16.54150, lng: -68.08000 },
        { nombre: "Obrajes", lat: -16.53720, lng: -68.10730 },
        { nombre: "Alto Irpavi", lat: -16.53100, lng: -68.06000 }
      ];

      ubicaciones.forEach(ubi => {
        L.marker([ubi.lat, ubi.lng])
          .addTo(map)
          .bindPopup(`<strong>${ubi.nombre}</strong>`);
      });
    } else {
      console.warn("El contenedor del mapa no fue encontrado.");
    }
  });
</script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>

</html>